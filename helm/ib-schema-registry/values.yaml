# Default values for ib-schema-registry.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Number of Schema Registry replicas to deploy (minimum 1 for HA is 3)
replicaCount: 1

# Container image configuration
image:
  repository: ghcr.io/infobloxopen/ib-schema-registry
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  # Leave empty ("") to use the chart appVersion.
  #
  # VERSIONING NOTES:
  # - Chart version: Full version with commit SHA (e.g., 8.1.1-ib.1.abc1234)
  # - Chart appVersion: Upstream Schema Registry version only (e.g., 8.1.1)
  # - Image tag: Defaults to appVersion unless overridden here
  #
  # The appVersion field tracks the upstream Confluent Schema Registry version,
  # ensuring clarity about which Schema Registry release is deployed. The full
  # chart version includes the commit SHA for complete traceability.
  #
  # Example override for specific build:
  # tag: "8.1.1-ib.1.abc1234"
  tag: ""

# Image pull secrets for private registries
imagePullSecrets: []
# - name: regcred

# Override the chart name
nameOverride: ""
fullnameOverride: ""

# Schema Registry configuration
config:
  # REQUIRED: Kafka bootstrap servers (comma-separated list)
  kafkaBootstrapServers: ""
  # kafkaBootstrapServers: "kafka-1:9092,kafka-2:9092,kafka-3:9092"
  
  # Additional Schema Registry properties
  # These will be appended to schema-registry.properties
  extraProperties: {}
  # schema.compatibility.level: "BACKWARD"
  # kafkastore.topic: "_schemas"
  # kafkastore.topic.replication.factor: "3"
  # debug: "true"

# JVM configuration
jvm:
  # Percentage of container memory to allocate to JVM heap (0-100)
  maxRAMPercentage: 75.0
  
  # Additional JVM options
  extraOpts: []
  # - "-Djava.security.auth.login.config=/etc/schema-registry/jaas.conf"
  # - "-Djavax.net.ssl.trustStore=/etc/schema-registry/truststore.jks"

# Service configuration
service:
  type: ClusterIP
  port: 8081
  # Additional service annotations
  annotations: {}
  # cloud.google.com/load-balancer-type: "Internal"

# Legacy service alias (optional)
# Enable this to create a second service with a legacy name
# that routes to the same pods as the main service
legacyService:
  enabled: false
  # Name of the legacy service (defaults to <fullname>-legacy if not specified)
  name: ""
  type: ClusterIP
  port: 8081
  # Additional annotations for the legacy service
  annotations: {}

# Resource requests and limits
resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 250m
    memory: 512Mi

# Liveness probe configuration
livenessProbe:
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 6
  successThreshold: 1

# Readiness probe configuration
readinessProbe:
  httpGet:
    path: /subjects
    port: http
  initialDelaySeconds: 20
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 6
  successThreshold: 1

# Security context for the container
securityContext:
  runAsNonRoot: true
  runAsUser: 65532
  runAsGroup: 65532
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL

# Security context for the pod
podSecurityContext:
  fsGroup: 65532
  seccompProfile:
    type: RuntimeDefault

# Pod annotations
podAnnotations: {}

# Pod labels
podLabels: {}

# ServiceAccount configuration
serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Automatically mount a ServiceAccount's API credentials
  automount: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# Pod Disruption Budget configuration
# Only created when replicaCount > 1
# Set enabled: true when deploying with multiple replicas for HA
podDisruptionBudget:
  enabled: false
  # minAvailable: 1  # Automatically calculated as ceil(replicaCount/2)

# Topology spread constraints for pod distribution
# Only applied when replicaCount > 1
topologySpreadConstraints:
  enabled: true
  maxSkew: 1
  topologyKey: topology.kubernetes.io/zone
  whenUnsatisfiable: ScheduleAnyway

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity rules
affinity: {}

# Prometheus JMX metrics export configuration
metrics:
  # Enable Prometheus metrics collection via JMX Exporter javaagent
  # When enabled, exposes HTTP /metrics endpoint on configured port
  enabled: false
  
  # TCP port for Prometheus metrics endpoint
  port: 9404
  
  # HTTP path for metrics scraping
  path: /metrics
  
  # Prometheus pod annotations for auto-discovery
  annotations:
    # Add prometheus.io/scrape, prometheus.io/port, prometheus.io/path annotations
    # to pod metadata for Prometheus Kubernetes service discovery
    enabled: true
  
  # Custom JMX exporter configuration (YAML format)
  # If not provided, uses default configuration that exports:
  # - Schema Registry MBeans (jetty-metrics, jersey-metrics, master-slave-role)
  # - Essential JVM metrics (memory, GC, threading)
  # See https://github.com/prometheus/jmx_exporter for configuration syntax
  config: null
  # config: |
  #   lowercaseOutputName: true
  #   whitelistObjectNames:
  #     - "kafka.schema.registry:type=jetty-metrics,*"
  #   rules:
  #     - pattern: 'kafka.schema.registry<type=jetty-metrics><>(.+):'
  #       name: kafka_schema_registry_jetty_$1
